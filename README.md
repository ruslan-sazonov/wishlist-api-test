## About
Simple RESTful API for managing user's whislist-to-products relations.
Application is based on `Symfony 5` framework. This repo also includes
docker services needed for testing. 

## How to start
1. `git clone` it somewhere: `https://github.com/ruslan-sazonov/wishlist-api-test.git`
2. `cd ./wishlist-api-test/docker && docker-compose up -d`
3. Grab some coffee and wait for it
4. Now you should have 3 operational docker services. The next step is to install app dependencies and run DB migrations
5. Run `docker exec -it product-api-fpm composer install && bin/console doctrine:migrations:migrate`
6. Run `docker exec -it product-api-fpm bin/console doctrine:fixtures:load` and confirm operation by answering `yes` to the prompt

Congratulations! From this point you should have fully operational application. Go and check it out at `http://localhost/`. You should receive a nasty mesage "Authentication Required". It's perfectly OK.


## How to have fun

### Authentication
Now you can test API endpoints by doing HTTP requests but first you need to deal with this "Authentication Required" thing. Application operates with some auto-generated data in your DB by default. It generates 10 test users who have their API tokens and default role. 

In order to get these tokens you should connect to DB and find `user.api_token` column values. Grab these and feel free to use 'em.
Every request is identified with a corresponding API token which should be specified in `X-AUTH-TOKEN` header:

```
GET /api/product
Host: localhost:80
X-AUTH-TOKEN: d1f8d131906fac93ba91eb9920ed8c155a0a343ecfc679fbb0f288455179274b
```

**Default DB credentials**
```
DATABASE_NAME=product_api_test
DATABASE_USER=product_user
DATABASE_PASSWORD=simplepasswd
```

## List of endpoints

### Product
**Get product list**
```
GET /api/product
Host: localhost:80
X-AUTH-TOKEN: {api_token}
```

### Wishlist
**Get list of user's wishlists**
```
GET /api/wishlist
Host: localhost:80
X-AUTH-TOKEN: {api_token}
```

**Get single wishlist by it's {id}**
```
GET /api/wishlist/{id}
Host: localhost:80
X-AUTH-TOKEN: {api_token}
```

**Create a brand new shiny wishlist**
```
POST /api/wishlist
Host: localhost:80
X-AUTH-TOKEN: {api_token}
Content-Type: application/json

{
  "name": "Test Wishlist"
}
```

**Delete wishlist by a given {id}**
```
DELETE /api/wishlist/{id}
Host: localhost:80
X-AUTH-TOKEN: {api_token}
```

**Get list of the attached products by wishlist {id}**
```
GET /api/wishlist/{id}/products
Host: localhost:80
X-AUTH-TOKEN: {api_token}
```

**Attach product to wishlist by given wishlist and product ids**
```
PUT /api/wishlist/{wId}/products/{pId}
Host: localhost:80
X-AUTH-TOKEN: {api_token}
```

**Detach product from wishlist by given wishlist and product ids**
```
DELETE /api/wishlist/{wId}/products/{pId}
Host: localhost:80
X-AUTH-TOKEN: {api_token}
```

## CSV Export

Also application has a possibility to export CSV report which can be generated by console command `export:wishlist:csv`.
Run `docker exec -it product-api-fpm bin/console export:wishlist:csv`
